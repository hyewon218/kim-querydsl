# í”„ë¡œì íŠ¸ í™˜ê²½ì„¤ì •

## ğŸ“QueryDSL

- JPAì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´ì§€í–¥ì¿¼ë¦¬ì¸ JPQL(Java Persistence Query Language)ì„ í†µí•´ ë™ì  ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ë©´ ì½”ë“œê°€ êµ‰ì¥íˆ ë‚œì¡í•´ì§„ë‹¤ëŠ” ê²ƒì„ ëŠë‚„ ìˆ˜ ìˆë‹¤.
- JPQLì€ `ë¬¸ìì—´`ì„ ì‚¬ìš©í•œë‹¤. ë¬¸ìì—´ì„ ì¡°ê±´ì— ë”°ë¼ ì´ì–´ë¶™ì´ëŠ” í˜•ì‹ìœ¼ë¡œ êµ¬ì„±í•˜ê¸° ë•Œë¬¸ì— ìƒê¸°ëŠ” ë¬¸ì œê°€ ìˆë‹¤. <br>
ë¬¸ìì—´ì´ê¸°ì—**ì˜¤íƒ€ê°€ ë°œìƒí•´ë„ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì—ëŸ¬ë¥¼ ì¡ì•„ì£¼ì§€ ëª»í•œë‹¤.**(ë‹¤ë§Œ, NamedQueryë¥¼ ì‚¬ìš©í•˜ë©´ ê°€ëŠ¥í•˜ë‹¤.) <br> 
ë˜í•œ ë™ì ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•  ë•Œ, ì¤‘ê°„ì¤‘ê°„ ifë¬¸ì— ì˜í•´ ë¬¸ìì—´ì´ ì¶”ê°€ë˜ê¸° ë•Œë¬¸ì— **ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤.** ë”°ë¼ì„œ ì¿¼ë¦¬ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ì–´ë µë‹¤.
- **QueryDSL**ì€ ìœ„ì™€ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤. <br>
Type-Safeí•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì—”í‹°í‹°ì™€ ë§¤í•‘ë˜ëŠ” ì •ì  íƒ€ì… QClassë¥¼ ìƒì„±í•´ ì¿¼ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì—ˆë‹¤. <br>
ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ë¥¼ ì¡ì•„ë‚¼ ìˆ˜ ìˆê³  ë©”ì†Œë“œ ì²´ì´ë‹ì„ í†µí•´ ì¡°ê±´ì„ ë³´ë‹¤ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ì¦‰, **ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ ìš©ì´í•´ì§„ë‹¤**ëŠ” ë§ì´ë‹¤.
- QueryDSLë„ ë‚´ë¶€ì ìœ¼ë¡œëŠ” JPQLë¥¼ êµ¬ì„±í•´ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ë‚¸ë‹¤. ë‹¤ë§Œ, ì‚¬ìš©ìë“¤ì´ í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì¶”ìƒí™”í•´ë†“ì€ JPQL ë¹Œë”ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

<br>

#### ğŸ“Œ IntelliJ Gradle ëŒ€ì‹ ì— ìë°”ë¡œ ë°”ë¡œ ì‹¤í–‰í•˜ê¸°
> ìµœê·¼ IntelliJ ë²„ì „ì€ Gradleë¡œ ì‹¤í–‰ì„ í•˜ëŠ” ê²ƒì´ ê¸°ë³¸ ì„¤ì •ì´ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì‹¤í–‰ì†ë„ê°€ ëŠë¦¬ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•˜ë©´ ìë°”ë¡œ ë°”ë¡œ ì‹¤í–‰í•˜ë¯€ë¡œ ì¢€ ë” ë¹¨ë¼ì§„ë‹¤.
1. Preferences Build,Execution,Deployment BuildTools Gradle
2. Build and run using: Gradle IntelliJ IDEA
3. Run tests using: Gradle IntelliJ IDEA<br>
   <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/24e54b4e-c69c-406f-8aad-b8bec5cd9651" width="60%"/><br>

<br>

#### ğŸ“Œ ë™ì‘ í™•ì¸
> - ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰
- ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¸ ì‹¤í–‰ í›„ ì—ëŸ¬í˜ì´ì§€ë¡œ ê°„ë‹¨í•˜ê²Œ ë™ì‘ í™•ì¸(http://localhost:8080)<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/888ee585-7daa-4a4e-acb1-b38c0e130289" width="60%"/><br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/abf5d418-67a3-459a-91d4-f5fcd8281932" width="60%"/><br>
- í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ì„œ spring web ë™ì‘ í™•ì¸(http://localhost:8080/hello)<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/d3045d8a-dc67-4011-ac04-9d3ae1200e58" width="60%"/><br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/c9e68393-54f4-492f-b3ac-10918861bb19" width="60%"/><br>

<br>

## ğŸ“Querydsl ì„¤ì •
```groovy
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.1.5'
    id 'io.spring.dependency-management' version '1.1.3'
}

group = 'study'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = '17'
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    compileOnly 'org.projectlombok:lombok'
    runtimeOnly 'com.h2database:h2'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'

    // Querydsl ì¶”ê°€ (Spring boot 3.x ì´ìƒ)
    implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
    annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"
    annotationProcessor "jakarta.annotation:jakarta.annotation-api"
    annotationProcessor "jakarta.persistence:jakarta.persistence-api"
}

tasks.named('test') {
    useJUnitPlatform()
}

/**
 * QueryDSL Build Options
 */
def querydslDir = "src/main/generated"

sourceSets {
    main.java.srcDirs += [ querydslDir ]
}

tasks.withType(JavaCompile).configureEach {
    options.getGeneratedSourceOutputDirectory().set(file(querydslDir))
}

clean.doLast {
    file(querydslDir).deleteDir()
}
```
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/4ccad035-2020-4ec5-817f-bc5c1106c8b7" width="60%"/><br>

<br>

## ğŸ“QClass ìƒì„± ë° ì‚­ì œ
### ìƒì„±
- Gradle - Task - other - compileJavaë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/711c5eb2-01b2-4eb1-8572-6535ecae942d" width="60%"/><br>
- ì•„ë˜ì™€ ê°™ì´ src/main/generated ê²½ë¡œì— QClassê°€ ìƒì„±ëœë‹¤.<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/e70a5473-79fb-4a81-b456-11a34b2d35a8" width="60%"/><br>
### ì‚­ì œ
- Gradle - Task - build - clean ì„ ì‹¤í–‰í•˜ë©´ ëœë‹¤.
- src/main/generated ë””ë ‰í† ë¦¬ì™€ íŒŒì¼ì´ ì „ë¶€ ì‚­ì œëœë‹¤.<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/3355c4f9-ee24-439f-af9b-fd7ac4eb8760" width="60%"/><br>
### ì£¼ì˜ì‚¬í•­
- src/main/generated ë””ë ‰í† ë¦¬ëŠ” ê°œë°œí•  ë•Œ í¸ì˜ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. <br>
ì‹¤ì œ ë°°í¬ë¥¼ ìœ„í•´ buildë¥¼ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ, ì½”ë“œ ì‹¤í–‰ì„ ìœ„í•´ í•„ìš”í•œ QClassë“¤ì´ <br>
build ë””ë ‰í† ë¦¬ì˜ entityì™€ ê°™ì€ ê²½ë¡œì— ì „ë¶€ í¬í•¨ë˜ê¸° ë•Œë¬¸ì— Dockerì™€ ê°™ì€ ì»¨í…Œì´ë„ˆì— generated ë””ë ‰í† ë¦¬ë¥¼ COPYí•´ì„œ ë„£ì„ ì´ìœ ê°€ ì—†ë‹¤.
- ì°¸ê³ : Qíƒ€ì…ì€ ì»´íŒŒì¼ ì‹œì ì— ìë™ ìƒì„±ë˜ë¯€ë¡œ ë²„ì „ê´€ë¦¬(GIT)ì— í¬í•¨í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤. <br>
ì•ì„œ ì„¤ì •ì—ì„œ ìƒì„± ìœ„ì¹˜ë¥¼ gradle build í´ë” ì•„ë˜ ìƒì„±ë˜ë„ë¡ í–ˆê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ë„ ìì—°ìŠ¤ëŸ½ê²Œ í•´ê²°ëœë‹¤. <br>
(ëŒ€ë¶€ë¶„ gradle build í´ë”ë¥¼ gitì— í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.)

<br>

## ğŸ“Querydsl ê²€ì¦
í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¡œ ì‹¤í–‰ ê²€ì¦<br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/88760e18-9846-439f-b5b9-b292db11d3b1" width="60%"/><br>

- Querydsl Qíƒ€ì…ì´ ì •ìƒ ë™ì‘í•˜ëŠ”ê°€?
- lombokì´ ì •ìƒ ë™ì‘ í•˜ëŠ”ê°€?
> ì°¸ê³ : ìŠ¤í”„ë§ ë¶€íŠ¸ì— ì•„ë¬´ëŸ° ì„¤ì •ë„ í•˜ì§€ ì•Šìœ¼ë©´ h2 DBë¥¼ ë©”ëª¨ë¦¬ ëª¨ë“œë¡œ JVMì•ˆì—ì„œ ì‹¤í–‰í•œë‹¤.

<br>

## ğŸ“**Querydsl ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚´í´ë³´ê¸°**
- querydsl-**apt**: Querydsl ê´€ë ¨ ì½”ë“œ **ìƒì„±** ê¸°ëŠ¥ ì œê³µ(ì½”ë“œ ì œë„ˆë ˆì´ì…˜  ë¼ì´ë¸ŒëŸ¬ë¦¬ ex)Qhello )
- querydsl-**jpa**: querydsl ë¼ì´ë¸ŒëŸ¬ë¦¬(ì‹¤ì œ ì½”ë“œ ì œë„ˆë ˆì´ì…˜ì„ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬)
- **querydsl-apt**ëŠ” ì†ŒìŠ¤ ì½”ë“œ ë ˆë²¨ì—ì„œ Querydsl ê´€ë ¨ ì–´ë…¸í…Œì´ì…˜ë“¤ì„ ì²˜ë¦¬í•˜ê³  ì¿¼ë¦¬ íƒ€ì… í´ë˜ìŠ¤ë“¤ì„ ìƒì„±í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.<br> 
ì´ë¥¼ í†µí•´ ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ëŠ” ëŒ€ì‹  Java ì½”ë“œë¥¼ í™œìš©í•˜ì—¬ ì»´íŒŒì¼ëŸ¬ê°€ ê²€ì‚¬í•˜ëŠ” ì•ˆì „í•œ ë°©ë²•ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.<br> 
sourceSetsì— QClassë¥¼ ì €ì¥í•  ê²½ë¡œë¥¼ ì„¤ì •í•´ì£¼ë©´ í•´ë‹¹ ê²½ë¡œì— ì¿¼ë¦¬ íƒ€ì… í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì¤€ë‹¤.<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/4404bef7-a1b6-45e6-8a71-03b442ac39f0" width="50%"/><br>
  í…ŒìŠ¤íŠ¸ì§¤ ë•Œ í¸ë¦¬í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬<br>
  <img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/9dbad58c-277a-4b59-b11f-465b31c15d46" width="50%"/><br>

<br>

## ğŸ“H2 ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì¹˜

ê°œë°œì´ë‚˜ í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ ê°€ë³ê³  í¸ë¦¬í•œ DB, ì›¹ í™”ë©´ ì œê³µ
```
Spring % cd /Users/choihyewon/Desktop/ê°œë°œ/Backend_Spring/Spring/kim-querydsl
kim-querydsl % cd h2/bin
bin % chmod 755 h2.sh
bin % ls -alrth
total 5136
-rw-rw-r--@ 1 choihyewon  staff   105B Sep 16 18:03 h2w.bat
-rwxr-xr-x@ 1 choihyewon  staff   109B Sep 16 18:03 h2.sh
-rw-rw-r--@ 1 choihyewon  staff    98B Sep 16 18:03 h2.bat
-rw-rw-r--@ 1 choihyewon  staff   2.5M Sep 16 18:03 h2-2.2.224.jar
drwxr-xr-x@ 6 choihyewon  staff   192B Oct 24 22:56 .
drwxr-xr-x@ 9 choihyewon  staff   288B Oct 24 22:59 ..
bin % ./h2.sh
```
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/29027f71-45f3-4231-96ac-d07d20de23c5" width="60%"/><br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/bac17cf4-6774-4fb6-a0c9-dab1f2d652ee" width="60%"/><br>

<br>

**ìµœì†Œ í•œë²ˆ**<br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/85bc6436-2157-49dd-ac46-7faa21956192" width="60%"/><br>

<br>

**ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±! â†’ ì—°ê²°ëŠê³  â†’ jdbc:h2:tcp://localhost/~/querydsl ì ‘ì†**<br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/44a09461-e19f-4d73-8738-342627ac3b1a" width="30%"/><br>

<br>

**insert**<br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/284fb6cf-0e87-4bea-9ec0-530d29608545" width="60%"/><br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/96849628-6a7f-48a4-b918-20bb13a65094" width="30%"/><br>

<br>

## ğŸ“Testì— Transactional ìˆëŠ” ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë‘ Rollback ì²˜ë¦¬
Rollbackì„ ë§‰ê¸° ìœ„í•´ì„œëŠ” `@Commit` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì£¼ë©´ ëœë‹¤.<br>
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/6a954f35-5610-4fe0-9d20-780698d92860" width="40%"/><br>

<br>

## ğŸ“Sqlì˜ valueë¥¼ ë³´ê¸° ìœ„í•œ ë°©ë²•
### 1. logging.level
```yaml
logging.level:
  org.hibernate.SQL: debug
  org.hibernate.type: trace
 ```
### 2. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€
ì¿¼ë¦¬íŒŒë¼ë¯¸í„° ë¡œê·¸ ë‚¨ê¸°ê¸° - ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0
```groovy
implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0'
```
<img src="https://github.com/hyewon218/kim-querydsl/assets/126750615/4cf494f5-fcd6-41df-8878-6a7271c18616" width="60%"/><br>
